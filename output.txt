============================= test session starts ==============================
platform linux -- Python 3.12.11, pytest-8.4.2, pluggy-1.6.0 -- /home/wenxindong_google_com/miniconda3/envs/wenxin_test/bin/python3
cachedir: .pytest_cache
rootdir: /home/wenxindong_google_com/tpu-inference
configfile: pyproject.toml
plugins: mock-3.15.0, jaxtyping-0.3.2, anyio-4.10.0
collecting ... INFO 02-06 21:30:07 [__init__.py:59] TPU info: node_name=wenxindong-v6e-2 | tpu_type=v6e-8 | worker_id=0 | num_chips=8 | num_cores_per_chip=1
INFO 02-06 21:30:09 [importing.py:44] Triton is installed but 0 active driver(s) found (expected 1). Disabling Triton to prevent runtime errors.
INFO 02-06 21:30:09 [importing.py:68] Triton not installed or not compatible; certain GPU-related functions will not be available.
collected 1 item

tests/e2e/test_data_parallel.py::test_dp_performance INFO 02-06 21:30:10 [utils.py:282] non-default args: {'max_model_len': 1024, 'data_parallel_size': 2, 'gpu_memory_utilization': 0.8, 'max_num_batched_tokens': 1024, 'max_num_seqs': 1024, 'disable_log_stats': True, 'async_scheduling': False, 'model': 'meta-llama/Meta-Llama-3-8B'}
INFO 02-06 21:30:11 [model.py:541] Resolved architecture: LlamaForCausalLM
INFO 02-06 21:30:11 [model.py:1558] Using max model len 1024
INFO 02-06 21:30:11 [scheduler.py:226] Chunked prefill is enabled with max_num_batched_tokens=1024.
INFO 02-06 21:30:11 [vllm.py:640] Asynchronous scheduling is disabled.
INFO 02-06 21:30:11 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=2, sharding_strategy=ShardingStrategy(tensor_parallelism=1, expert_parallelism=1, sequence_parallelism=1, data_parallelism=2, attention_data_parallelism=1), device_indexes=None)
WARNING 02-06 21:30:11 [interface.py:222] Failed to import from vllm._C: ModuleNotFoundError("No module named 'vllm._C'")
INFO 02-06 21:30:11 [tpu_platform.py:87] Automatically using fp8_e5m2 for FP8 KV cache on TPU v6e.
INFO 02-06 21:30:11 [tpu_platform.py:87] Automatically using fp8_e5m2 for FP8 KV cache on TPU v6e.
INFO 02-06 21:30:11 [tpu_platform.py:87] Automatically using fp8_e5m2 for FP8 KV cache on TPU v6e.
INFO 02-06 21:30:11 [tpu_platform.py:87] Automatically using fp8_e5m2 for FP8 KV cache on TPU v6e.
INFO 02-06 21:30:12 [__init__.py:108] Registered model loader `<class 'tpu_inference.models.vllm.vllm_model_loader.IncrementalModelLoader'>` with load format `tpu_streaming_loader`
INFO 02-06 21:30:12 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
WARNING 02-06 21:30:12 [tpu_platform.py:217] Pin memory is not supported on TPU.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:12 [core.py:96] Initializing a V1 LLM engine (v0.11.1rc6.dev215+gd9ab1ad9d.d20251114) with config: model='meta-llama/Meta-Llama-3-8B', speculative_config=None, tokenizer='meta-llama/Meta-Llama-3-8B', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=1024, download_dir=None, load_format=auto, tensor_parallel_size=1, pipeline_parallel_size=1, data_parallel_size=1, disable_custom_all_reduce=True, quantization=None, enforce_eager=False, enable_return_routed_experts=False, kv_cache_dtype=auto, device_config=None, structured_outputs_config=StructuredOutputsConfig(backend='auto', disable_fallback=False, disable_any_whitespace=False, disable_additional_properties=False, reasoning_parser='', reasoning_parser_plugin='', enable_in_reasoning=False), observability_config=ObservabilityConfig(show_hidden_metrics_for_version=None, otlp_traces_endpoint=None, collect_detailed_traces=None, kv_cache_metrics=False, kv_cache_metrics_sample=0.01, cudagraph_metrics=False, enable_layerwise_nvtx_tracing=False, enable_mfu_metrics=False, enable_mm_processor_stats=False, enable_logging_iteration_details=False), seed=0, served_model_name=meta-llama/Meta-Llama-3-8B, enable_prefix_caching=True, enable_chunked_prefill=True, pooler_config=None, compilation_config={'level': None, 'mode': <CompilationMode.DYNAMO_TRACE_ONCE: 2>, 'debug_dump_path': None, 'cache_dir': '', 'compile_cache_save_format': 'binary', 'backend': 'openxla', 'custom_ops': ['all'], 'splitting_ops': [], 'compile_mm_encoder': False, 'compile_sizes': None, 'compile_ranges_split_points': [1024], 'inductor_compile_config': {'enable_auto_functionalized_v2': False}, 'inductor_passes': {}, 'cudagraph_mode': <CUDAGraphMode.NONE: 0>, 'cudagraph_num_of_warmups': 0, 'cudagraph_capture_sizes': None, 'cudagraph_copy_inputs': False, 'cudagraph_specialize_lora': True, 'use_inductor_graph_partition': False, 'pass_config': {'fuse_norm_quant': True, 'fuse_act_quant': True, 'fuse_attn_quant': False, 'eliminate_noops': True, 'enable_sp': False, 'fuse_gemm_comms': False, 'fuse_allreduce_rms': False, 'fuse_act_padding': False}, 'max_cudagraph_capture_size': None, 'dynamic_shapes_config': {'type': <DynamicShapesType.BACKED: 'backed'>, 'evaluate_guards': False, 'assume_32_bit_indexing': False}, 'local_cache_dir': None, 'static_all_moe_layers': []}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [parallel_state.py:1234] world_size=1 rank=0 local_rank=0 distributed_init_method=file:///tmp/tmphfr52t9y backend=gloo
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [parallel_state.py:1445] rank 0 in world size 1 is assigned as DP rank 0, PP rank 0, PCP rank 0, TP rank 0, EP rank N/A
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [tpu_runner.py:302] Creating new model mesh | devices=2, num_slices=1
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [tpu_runner.py:297] Init mesh | mesh=Mesh('data': 2, 'attn_dp': 1, 'expert': 1, 'model': 1, axis_types=(Auto, Auto, Auto, Auto))
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [utils.py:94] Prepared token paddings: [16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [utils.py:60] Prepared request paddings: [8, 16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [compilation_manager.py:52] Enabling JAX compile cache.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [tpu_worker.py:247] Init worker | rank=0 | is_first_rank=True | is_last_rank=True | topology_order_id=0 | is_driver_worker=True | hbm=[(0.0, 31.25), (0.0, 31.25)]GiB |self.devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0)] | total devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)] | local_devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)]
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:22 [model_loader.py:379] Loading model with MODEL_IMPL_TYPE=flax_nnx
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:23 [weight_utils.py:144] Downloading weights from HF meta-llama/Meta-Llama-3-8B
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:23 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00001-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:23 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00002-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:23 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00003-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:23 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00004-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [tpu_runner.py:529] Init model | hbm=[(14.96, 31.25), (14.96, 31.25)]GiB
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [tpu_worker.py:281] Memory statistics | total_hbm_limit_gb=62.49GiB | total_hbm_limit_cap_gb=49.99GiB | total_hbm_used_gb=29.92GiB | total_hbm_avail_gb=20.08GiB
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [kv_cache_utils.py:1307] GPU KV cache size: 164,416 tokens
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [kv_cache_utils.py:1312] Maximum concurrency for 1,024 tokens per request: 160.56x
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [compilation_manager.py:502] Compiling sampling with different input shapes.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:28 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:29 [compilation_manager.py:85] Compilation finished in 0.39 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:29 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:29 [compilation_manager.py:85] Compilation finished in 0.40 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:29 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:30 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:31 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:31 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:31 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:31 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:31 [compilation_manager.py:85] Compilation finished in 0.64 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:31 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:85] Compilation finished in 0.67 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:32 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:33 [compilation_manager.py:85] Compilation finished in 0.80 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:33 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:34 [compilation_manager.py:85] Compilation finished in 0.79 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:34 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:34 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:34 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:35 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:35 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:36 [compilation_manager.py:85] Compilation finished in 0.99 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:36 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:37 [compilation_manager.py:85] Compilation finished in 0.96 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:37 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:37 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:37 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:37 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:38 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:39 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:85] Compilation finished in 0.15 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:40 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:41 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:41 [compilation_manager.py:575] Compiling gather_logprobs with different input shapes.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:41 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:41 [compilation_manager.py:85] Compilation finished in 0.40 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:41 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:42 [compilation_manager.py:85] Compilation finished in 0.52 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:42 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:42 [compilation_manager.py:85] Compilation finished in 0.53 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:42 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:43 [compilation_manager.py:85] Compilation finished in 0.52 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:43 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:43 [compilation_manager.py:85] Compilation finished in 0.52 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:44 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:44 [compilation_manager.py:85] Compilation finished in 0.52 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:44 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:45 [compilation_manager.py:85] Compilation finished in 0.52 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:45 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:45 [compilation_manager.py:85] Compilation finished in 0.53 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:45 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:46 [compilation_manager.py:85] Compilation finished in 0.58 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:48 [kv_cache_manager.py:272] Init kv-cache | num_layers=32 | shape=(num_blocks, (64, 8, 2, 128)) | num_blocks=[np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568), np.int64(2568)] | sharding=NamedSharding(mesh=Mesh('data': 2, 'attn_dp': 1, 'expert': 1, 'model': 1, axis_types=(Auto, Auto, Auto, Auto)), spec=PartitionSpec(('data', 'attn_dp'), None, ('model', 'expert')), memory_kind=device) | dtype=bfloat16 | hbm=[(25.02, 31.25), (25.02, 31.25)]Gb
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:48 [compilation_manager.py:90] Precompile all the subgraphs with possible input shapes.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:48 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m WARNING 02-06 21:30:48 [tuned_block_sizes.py:4368] Couldn`t find tuned sizes for the RPA v3 kernel with ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None')
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:48 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=8
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:50 [compilation_manager.py:85] Compilation finished in 2.23 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:50 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:50 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=16
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:52 [compilation_manager.py:85] Compilation finished in 1.70 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:52 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:52 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=32
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:53 [compilation_manager.py:85] Compilation finished in 1.69 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:53 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:55 [compilation_manager.py:85] Compilation finished in 2.13 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:55 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:57 [compilation_manager.py:85] Compilation finished in 1.70 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:57 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 512}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:59 [compilation_manager.py:85] Compilation finished in 1.66 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:30:59 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 1024}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:01 [compilation_manager.py:85] Compilation finished in 2.30 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:01 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 2048}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 1.68 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:432] Compiling select_from_array with different input shapes.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:411] Compiling select_from_array for worker0 select all logits.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:85] Compilation finished in 0.21 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:05 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:06 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:07 [compilation_manager.py:85] Compilation finished in 0.39 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:07 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:07 [compilation_manager.py:85] Compilation finished in 0.71 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:85] Compilation finished in 0.18 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:08 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:09 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:09 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:09 [compilation_manager.py:85] Compilation finished in 0.46 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:09 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:10 [compilation_manager.py:85] Compilation finished in 0.78 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:10 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:11 [compilation_manager.py:85] Compilation finished in 0.79 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:11 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:11 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:11 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:11 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:11 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:12 [compilation_manager.py:85] Compilation finished in 0.32 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:12 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:12 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:12 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:13 [compilation_manager.py:85] Compilation finished in 0.43 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:13 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:13 [compilation_manager.py:85] Compilation finished in 0.59 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:13 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:13 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:13 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:14 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:14 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 2048}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:85] Compilation finished in 0.60 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:480] Compiling compute_logits with different input shapes.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:15 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:16 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:16 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:16 [compilation_manager.py:85] Compilation finished in 0.33 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:16 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:16 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:16 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:17 [compilation_manager.py:85] Compilation finished in 0.41 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:17 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:17 [compilation_manager.py:85] Compilation finished in 0.54 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:17 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:18 [compilation_manager.py:85] Compilation finished in 0.83 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:18 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:18 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:18 [compilation_manager.py:895] Compiling structured_decoding with different input shapes.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m WARNING 02-06 21:31:18 [compilation_manager.py:898] Structured decoding precompilation skipped since structured decoding is not supported with DP.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:18 [core.py:272] init engine (profile, create kv cache, warmup model) took 49.91 seconds
[0;36m(EngineCore_DP0 pid=3942438)[0;0m WARNING 02-06 21:31:18 [scheduler.py:168] Using custom scheduler class <class 'tpu_inference.core.sched.dp_scheduler.DPScheduler'>. This scheduler interface is not public and compatibility may not be maintained.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:19 [dp_scheduler.py:350] DPScheduler (Async = False) started 2 worker processes with cloudpickle. Per-rank limits: max_seqs=1024, max_tokens=1024
[0;36m(EngineCore_DP0 pid=3942438)[0;0m WARNING 02-06 21:31:20 [vllm.py:685] Inductor compilation was disabled by user settings, optimizations settings that are only active during inductor compilation will be ignored.
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:20 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=1, sharding_strategy=ShardingStrategy(tensor_parallelism=1, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=1), device_indexes=None)
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:20 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
INFO 02-06 21:31:20 [llm.py:343] Supported tasks: ['generate']
Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]Adding requests:  20%|â–ˆâ–‰        | 403/2048 [00:00<00:00, 4026.87it/s]Adding requests:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 871/2048 [00:00<00:00, 4405.28it/s]Adding requests:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1338/2048 [00:00<00:00, 4522.27it/s]Adding requests:  88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 1800/2048 [00:00<00:00, 4559.07it/s]Adding requests: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:00<00:00, 4513.65it/s]
Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]Processed prompts:   0%|          | 1/2048 [00:03<1:55:12,  3.38s/it, est. speed input: 24.87 toks/s, output: 9.48 toks/s]Processed prompts:   2%|â–         | 49/2048 [00:03<01:44, 19.20it/s, est. speed input: 1159.72 toks/s, output: 441.80 toks/s]Processed prompts:   5%|â–         | 95/2048 [00:03<00:47, 41.15it/s, est. speed input: 2145.16 toks/s, output: 817.20 toks/s]Processed prompts:   7%|â–‹         | 143/2048 [00:03<00:28, 67.96it/s, est. speed input: 3088.73 toks/s, output: 1176.66 toks/s]Processed prompts:   9%|â–‰         | 187/2048 [00:04<00:19, 94.37it/s, est. speed input: 3873.44 toks/s, output: 1475.59 toks/s]Processed prompts:  11%|â–ˆâ–        | 231/2048 [00:04<00:14, 122.13it/s, est. speed input: 4599.70 toks/s, output: 1752.26 toks/s]Processed prompts:  13%|â–ˆâ–Ž        | 275/2048 [00:04<00:11, 149.73it/s, est. speed input: 5274.56 toks/s, output: 2009.35 toks/s]Processed prompts:  15%|â–ˆâ–Œ        | 317/2048 [00:04<00:10, 172.46it/s, est. speed input: 5863.07 toks/s, output: 2233.54 toks/s]Processed prompts:  17%|â–ˆâ–‹        | 357/2048 [00:04<00:08, 190.05it/s, est. speed input: 6378.21 toks/s, output: 2429.79 toks/s]Processed prompts:  19%|â–ˆâ–Š        | 383/2048 [00:05<00:12, 129.73it/s, est. speed input: 6269.20 toks/s, output: 2388.26 toks/s]Processed prompts:  20%|â–ˆâ–ˆ        | 417/2048 [00:05<00:10, 155.37it/s, est. speed input: 6679.87 toks/s, output: 2544.71 toks/s]Processed prompts:  22%|â–ˆâ–ˆâ–       | 455/2048 [00:05<00:08, 189.10it/s, est. speed input: 7143.91 toks/s, output: 2721.48 toks/s]Processed prompts:  24%|â–ˆâ–ˆâ–       | 493/2048 [00:05<00:07, 220.55it/s, est. speed input: 7586.44 toks/s, output: 2890.06 toks/s]Processed prompts:  26%|â–ˆâ–ˆâ–Œ       | 531/2048 [00:05<00:06, 249.46it/s, est. speed input: 8013.67 toks/s, output: 3052.81 toks/s]Processed prompts:  28%|â–ˆâ–ˆâ–Š       | 567/2048 [00:05<00:05, 271.08it/s, est. speed input: 8398.33 toks/s, output: 3199.36 toks/s]Processed prompts:  29%|â–ˆâ–ˆâ–‰       | 601/2048 [00:05<00:05, 282.51it/s, est. speed input: 8736.27 toks/s, output: 3328.09 toks/s]Processed prompts:  31%|â–ˆâ–ˆâ–ˆ       | 635/2048 [00:05<00:05, 279.73it/s, est. speed input: 9035.85 toks/s, output: 3442.22 toks/s]Processed prompts:  33%|â–ˆâ–ˆâ–ˆâ–Ž      | 669/2048 [00:06<00:05, 255.15it/s, est. speed input: 9265.87 toks/s, output: 3529.85 toks/s]Processed prompts:  34%|â–ˆâ–ˆâ–ˆâ–      | 703/2048 [00:06<00:05, 240.44it/s, est. speed input: 9485.04 toks/s, output: 3613.34 toks/s]Processed prompts:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 737/2048 [00:06<00:05, 231.10it/s, est. speed input: 9693.56 toks/s, output: 3692.77 toks/s]Processed prompts:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 773/2048 [00:06<00:05, 229.67it/s, est. speed input: 9920.19 toks/s, output: 3779.11 toks/s]Processed prompts:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 807/2048 [00:06<00:05, 223.67it/s, est. speed input: 10107.12 toks/s, output: 3850.32 toks/s]Processed prompts:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 843/2048 [00:06<00:05, 223.36it/s, est. speed input: 10309.48 toks/s, output: 3927.41 toks/s]Processed prompts:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 877/2048 [00:07<00:05, 220.14it/s, est. speed input: 10481.43 toks/s, output: 3992.91 toks/s]Processed prompts:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 913/2048 [00:07<00:05, 220.99it/s, est. speed input: 10666.60 toks/s, output: 4063.46 toks/s]Processed prompts:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 949/2048 [00:07<00:05, 215.12it/s, est. speed input: 10820.12 toks/s, output: 4121.94 toks/s]Processed prompts:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 985/2048 [00:07<00:04, 218.27it/s, est. speed input: 10992.75 toks/s, output: 4187.70 toks/s]Processed prompts:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 1019/2048 [00:07<00:04, 215.50it/s, est. speed input: 11134.10 toks/s, output: 4240.61 toks/s]Processed prompts:  52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1055/2048 [00:07<00:04, 217.83it/s, est. speed input: 11295.26 toks/s, output: 4300.28 toks/s]Processed prompts:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 1091/2048 [00:08<00:04, 219.67it/s, est. speed input: 11450.63 toks/s, output: 4357.81 toks/s]Processed prompts:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1125/2048 [00:08<00:04, 215.78it/s, est. speed input: 11573.88 toks/s, output: 4403.26 toks/s]Processed prompts:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 1161/2048 [00:08<00:04, 217.89it/s, est. speed input: 11716.66 toks/s, output: 4456.13 toks/s]Processed prompts:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 1183/2048 [00:08<00:06, 132.29it/s, est. speed input: 11379.45 toks/s, output: 4327.06 toks/s]Processed prompts:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 1215/2048 [00:08<00:05, 159.73it/s, est. speed input: 11551.31 toks/s, output: 4391.24 toks/s]Processed prompts:  61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 1249/2048 [00:08<00:04, 189.27it/s, est. speed input: 11734.96 toks/s, output: 4459.87 toks/s]Processed prompts:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 1285/2048 [00:09<00:03, 221.06it/s, est. speed input: 11935.74 toks/s, output: 4534.97 toks/s]Processed prompts:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1321/2048 [00:09<00:02, 249.52it/s, est. speed input: 12133.97 toks/s, output: 4609.12 toks/s]Processed prompts:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1355/2048 [00:09<00:02, 264.99it/s, est. speed input: 12302.00 toks/s, output: 4671.90 toks/s]Processed prompts:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 1391/2048 [00:09<00:02, 283.96it/s, est. speed input: 12488.12 toks/s, output: 4741.50 toks/s]Processed prompts:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 1427/2048 [00:09<00:02, 263.59it/s, est. speed input: 12601.20 toks/s, output: 4783.41 toks/s]Processed prompts:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 1461/2048 [00:09<00:02, 245.40it/s, est. speed input: 12689.15 toks/s, output: 4815.87 toks/s]Processed prompts:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 1497/2048 [00:09<00:02, 245.90it/s, est. speed input: 12812.03 toks/s, output: 4861.55 toks/s]Processed prompts:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 1533/2048 [00:09<00:02, 257.04it/s, est. speed input: 12957.41 toks/s, output: 4915.80 toks/s]Processed prompts:  77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 1567/2048 [00:10<00:01, 270.47it/s, est. speed input: 13102.89 toks/s, output: 4970.16 toks/s]Processed prompts:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 1603/2048 [00:10<00:01, 290.86it/s, est. speed input: 13271.20 toks/s, output: 5033.15 toks/s]Processed prompts:  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 1655/2048 [00:10<00:01, 312.07it/s, est. speed input: 13509.52 toks/s, output: 5122.34 toks/s]Processed prompts:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 1709/2048 [00:10<00:01, 338.48it/s, est. speed input: 13772.26 toks/s, output: 5220.78 toks/s]Processed prompts:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 1761/2048 [00:10<00:00, 363.05it/s, est. speed input: 14030.13 toks/s, output: 5317.45 toks/s]Processed prompts:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 1815/2048 [00:10<00:00, 402.07it/s, est. speed input: 14321.09 toks/s, output: 5426.64 toks/s]Processed prompts:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 1885/2048 [00:10<00:00, 455.15it/s, est. speed input: 14711.10 toks/s, output: 5573.07 toks/s]Processed prompts:  96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 1973/2048 [00:10<00:00, 544.08it/s, est. speed input: 15239.61 toks/s, output: 5771.67 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:11<00:00, 544.08it/s, est. speed input: 15721.03 toks/s, output: 5952.70 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:11<00:00, 186.02it/s, est. speed input: 15721.03 toks/s, output: 5952.70 toks/s]
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:32 [dp_scheduler.py:226] Rank 0: Shutting down
[0;36m(EngineCore_DP0 pid=3942438)[0;0m INFO 02-06 21:31:32 [dp_scheduler.py:226] Rank 1: Shutting down
INFO 02-06 21:31:47 [utils.py:282] non-default args: {'max_model_len': 1024, 'gpu_memory_utilization': 0.8, 'max_num_batched_tokens': 2048, 'max_num_seqs': 2048, 'disable_log_stats': True, 'async_scheduling': False, 'model': 'meta-llama/Meta-Llama-3-8B'}
INFO 02-06 21:31:48 [model.py:541] Resolved architecture: LlamaForCausalLM
INFO 02-06 21:31:48 [model.py:1558] Using max model len 1024
INFO 02-06 21:31:48 [scheduler.py:226] Chunked prefill is enabled with max_num_batched_tokens=2048.
INFO 02-06 21:31:48 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=1, sharding_strategy=ShardingStrategy(tensor_parallelism=1, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=1), device_indexes=None)
INFO 02-06 21:31:48 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:48 [core.py:96] Initializing a V1 LLM engine (v0.11.1rc6.dev215+gd9ab1ad9d.d20251114) with config: model='meta-llama/Meta-Llama-3-8B', speculative_config=None, tokenizer='meta-llama/Meta-Llama-3-8B', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=1024, download_dir=None, load_format=auto, tensor_parallel_size=1, pipeline_parallel_size=1, data_parallel_size=1, disable_custom_all_reduce=True, quantization=None, enforce_eager=False, enable_return_routed_experts=False, kv_cache_dtype=auto, device_config=None, structured_outputs_config=StructuredOutputsConfig(backend='auto', disable_fallback=False, disable_any_whitespace=False, disable_additional_properties=False, reasoning_parser='', reasoning_parser_plugin='', enable_in_reasoning=False), observability_config=ObservabilityConfig(show_hidden_metrics_for_version=None, otlp_traces_endpoint=None, collect_detailed_traces=None, kv_cache_metrics=False, kv_cache_metrics_sample=0.01, cudagraph_metrics=False, enable_layerwise_nvtx_tracing=False, enable_mfu_metrics=False, enable_mm_processor_stats=False, enable_logging_iteration_details=False), seed=0, served_model_name=meta-llama/Meta-Llama-3-8B, enable_prefix_caching=True, enable_chunked_prefill=True, pooler_config=None, compilation_config={'level': None, 'mode': <CompilationMode.DYNAMO_TRACE_ONCE: 2>, 'debug_dump_path': None, 'cache_dir': '', 'compile_cache_save_format': 'binary', 'backend': 'openxla', 'custom_ops': ['all'], 'splitting_ops': [], 'compile_mm_encoder': False, 'compile_sizes': None, 'compile_ranges_split_points': [2048], 'inductor_compile_config': {'enable_auto_functionalized_v2': False}, 'inductor_passes': {}, 'cudagraph_mode': <CUDAGraphMode.NONE: 0>, 'cudagraph_num_of_warmups': 0, 'cudagraph_capture_sizes': None, 'cudagraph_copy_inputs': False, 'cudagraph_specialize_lora': True, 'use_inductor_graph_partition': False, 'pass_config': {'fuse_norm_quant': True, 'fuse_act_quant': True, 'fuse_attn_quant': False, 'eliminate_noops': True, 'enable_sp': False, 'fuse_gemm_comms': False, 'fuse_allreduce_rms': False, 'fuse_act_padding': False}, 'max_cudagraph_capture_size': None, 'dynamic_shapes_config': {'type': <DynamicShapesType.BACKED: 'backed'>, 'evaluate_guards': False, 'assume_32_bit_indexing': False}, 'local_cache_dir': None, 'static_all_moe_layers': []}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [parallel_state.py:1234] world_size=1 rank=0 local_rank=0 distributed_init_method=file:///tmp/tmpzxuij7xo backend=gloo
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [parallel_state.py:1445] rank 0 in world size 1 is assigned as DP rank 0, PP rank 0, PCP rank 0, TP rank 0, EP rank N/A
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [tpu_runner.py:302] Creating new model mesh | devices=1, num_slices=1
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [tpu_runner.py:297] Init mesh | mesh=Mesh('data': 1, 'attn_dp': 1, 'expert': 1, 'model': 1, axis_types=(Auto, Auto, Auto, Auto))
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [utils.py:94] Prepared token paddings: [16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [utils.py:60] Prepared request paddings: [8, 16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [compilation_manager.py:52] Enabling JAX compile cache.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [tpu_worker.py:247] Init worker | rank=0 | is_first_rank=True | is_last_rank=True | topology_order_id=0 | is_driver_worker=True | hbm=[(0.0, 31.25)]GiB |self.devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0)] | total devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)] | local_devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)]
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [model_loader.py:379] Loading model with MODEL_IMPL_TYPE=flax_nnx
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [weight_utils.py:144] Downloading weights from HF meta-llama/Meta-Llama-3-8B
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00001-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00002-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00003-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:31:58 [weight_utils.py:166] Loading weights from /mnt/disks/extra1000/hub/models--meta-llama--Meta-Llama-3-8B/snapshots/8cde5ca8380496c9a6cc7ef3a8b46a0372a1d920/model-00004-of-00004.safetensors
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [tpu_runner.py:529] Init model | hbm=[(14.96, 31.25)]GiB
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [tpu_worker.py:281] Memory statistics | total_hbm_limit_gb=31.25GiB | total_hbm_limit_cap_gb=25.0GiB | total_hbm_used_gb=14.96GiB | total_hbm_avail_gb=10.04GiB
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [kv_cache_utils.py:1307] GPU KV cache size: 82,176 tokens
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [kv_cache_utils.py:1312] Maximum concurrency for 1,024 tokens per request: 80.25x
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:502] Compiling sampling with different input shapes.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:85] Compilation finished in 0.28 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:03 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:04 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:04 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:04 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:85] Compilation finished in 0.63 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:85] Compilation finished in 0.66 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:05 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:06 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:06 [compilation_manager.py:85] Compilation finished in 0.82 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:06 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:07 [compilation_manager.py:85] Compilation finished in 0.75 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:07 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:07 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:07 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:08 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:08 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:09 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:09 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:10 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:10 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:10 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:10 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:10 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:10 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:11 [compilation_manager.py:85] Compilation finished in 0.96 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:11 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:12 [compilation_manager.py:85] Compilation finished in 0.97 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:12 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:13 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:13 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:13 [compilation_manager.py:85] Compilation finished in 0.39 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:13 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:14 [compilation_manager.py:85] Compilation finished in 1.42 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:14 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:15 [compilation_manager.py:85] Compilation finished in 0.98 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:15 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:16 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:16 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:16 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:16 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:17 [compilation_manager.py:85] Compilation finished in 1.06 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:17 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:18 [compilation_manager.py:85] Compilation finished in 1.04 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:18 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:85] Compilation finished in 0.15 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:19 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:20 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:20 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:20 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:20 [compilation_manager.py:575] Compiling gather_logprobs with different input shapes.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:20 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.49 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.54 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:21 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:22 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:23 [kv_cache_manager.py:272] Init kv-cache | num_layers=32 | shape=(num_blocks, (64, 8, 2, 128)) | num_blocks=[np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284), np.int64(1284)] | sharding=NamedSharding(mesh=Mesh('data': 1, 'attn_dp': 1, 'expert': 1, 'model': 1, axis_types=(Auto, Auto, Auto, Auto)), spec=PartitionSpec(('data', 'attn_dp'), None, ('model', 'expert')), memory_kind=device) | dtype=bfloat16 | hbm=[(25.02, 31.25)]Gb
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:23 [compilation_manager.py:90] Precompile all the subgraphs with possible input shapes.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:23 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m WARNING 02-06 21:32:23 [tuned_block_sizes.py:4368] Couldn`t find tuned sizes for the RPA v3 kernel with ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None')
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:23 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=16
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:25 [compilation_manager.py:85] Compilation finished in 1.47 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:25 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:25 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-32_kv_head-8_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=32
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:26 [compilation_manager.py:85] Compilation finished in 1.39 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:26 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:28 [compilation_manager.py:85] Compilation finished in 1.87 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:28 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:29 [compilation_manager.py:85] Compilation finished in 1.37 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:29 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:31 [compilation_manager.py:85] Compilation finished in 1.36 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:31 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:33 [compilation_manager.py:85] Compilation finished in 2.01 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:33 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 1024}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:34 [compilation_manager.py:85] Compilation finished in 1.39 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:34 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 2048}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:35 [compilation_manager.py:85] Compilation finished in 1.41 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:35 [compilation_manager.py:432] Compiling select_from_array with different input shapes.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:35 [compilation_manager.py:411] Compiling select_from_array for worker0 select all logits.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:35 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:35 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:35 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.19 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:36 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:37 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:38 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:38 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:38 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:38 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:38 [compilation_manager.py:85] Compilation finished in 0.38 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:38 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:39 [compilation_manager.py:85] Compilation finished in 0.71 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:39 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:39 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:39 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:39 [compilation_manager.py:85] Compilation finished in 0.19 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:39 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:40 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:40 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:40 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:40 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:40 [compilation_manager.py:85] Compilation finished in 0.45 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:40 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:41 [compilation_manager.py:85] Compilation finished in 0.79 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:41 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:42 [compilation_manager.py:85] Compilation finished in 0.77 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:42 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:42 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:42 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:43 [compilation_manager.py:85] Compilation finished in 0.32 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:43 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:43 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:43 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:43 [compilation_manager.py:85] Compilation finished in 0.42 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:43 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:44 [compilation_manager.py:85] Compilation finished in 0.59 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:44 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:44 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:44 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:44 [compilation_manager.py:85] Compilation finished in 0.01 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:44 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.58 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.21 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:45 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 2048}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:480] Compiling compute_logits with different input shapes.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:85] Compilation finished in 0.26 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:85] Compilation finished in 0.32 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:46 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:47 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:47 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:47 [compilation_manager.py:85] Compilation finished in 0.41 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:47 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:48 [compilation_manager.py:85] Compilation finished in 0.54 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:48 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:85] Compilation finished in 0.83 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:85] Compilation finished in 0.03 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:85] Compilation finished in 0.02 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:895] Compiling structured_decoding with different input shapes.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:85] Compilation finished in 0.58 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:49 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:50 [compilation_manager.py:85] Compilation finished in 0.56 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:50 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:50 [compilation_manager.py:85] Compilation finished in 0.56 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:50 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:50 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:50 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:85] Compilation finished in 0.28 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:85] Compilation finished in 0.28 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:51 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:52 [compilation_manager.py:85] Compilation finished in 0.29 [secs].
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:52 [core.py:272] init engine (profile, create kv cache, warmup model) took 48.81 seconds
[0;36m(EngineCore_DP0 pid=3948435)[0;0m WARNING 02-06 21:32:53 [vllm.py:685] Inductor compilation was disabled by user settings, optimizations settings that are only active during inductor compilation will be ignored.
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:53 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=1, sharding_strategy=ShardingStrategy(tensor_parallelism=1, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=1), device_indexes=None)
[0;36m(EngineCore_DP0 pid=3948435)[0;0m INFO 02-06 21:32:53 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
INFO 02-06 21:32:53 [llm.py:343] Supported tasks: ['generate']
Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]Adding requests:  22%|â–ˆâ–ˆâ–       | 455/2048 [00:00<00:00, 4547.65it/s]Adding requests:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 914/2048 [00:00<00:00, 4570.96it/s]Adding requests:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 1372/2048 [00:00<00:00, 4568.52it/s]Adding requests:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 1829/2048 [00:00<00:00, 4567.72it/s]Adding requests: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:00<00:00, 4561.03it/s]
Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]Processed prompts:   0%|          | 1/2048 [00:02<1:29:46,  2.63s/it, est. speed input: 31.92 toks/s, output: 12.16 toks/s]Processed prompts:   1%|â–         | 26/2048 [00:02<02:34, 13.07it/s, est. speed input: 792.32 toks/s, output: 301.83 toks/s]Processed prompts:   2%|â–         | 50/2048 [00:02<01:11, 28.01it/s, est. speed input: 1458.94 toks/s, output: 555.78 toks/s]Processed prompts:   4%|â–Ž         | 74/2048 [00:03<00:43, 45.59it/s, est. speed input: 2071.63 toks/s, output: 789.19 toks/s]Processed prompts:   5%|â–         | 97/2048 [00:03<00:30, 64.04it/s, est. speed input: 2608.70 toks/s, output: 993.78 toks/s]Processed prompts:   6%|â–Œ         | 121/2048 [00:03<00:22, 84.95it/s, est. speed input: 3133.61 toks/s, output: 1193.75 toks/s]Processed prompts:   7%|â–‹         | 143/2048 [00:03<00:18, 102.35it/s, est. speed input: 3569.03 toks/s, output: 1359.62 toks/s]Processed prompts:   8%|â–Š         | 166/2048 [00:03<00:15, 120.75it/s, est. speed input: 4001.30 toks/s, output: 1524.30 toks/s]Processed prompts:   9%|â–‰         | 189/2048 [00:03<00:13, 137.01it/s, est. speed input: 4405.14 toks/s, output: 1678.14 toks/s]Processed prompts:  10%|â–ˆ         | 211/2048 [00:03<00:12, 148.07it/s, est. speed input: 4758.34 toks/s, output: 1812.69 toks/s]Processed prompts:  11%|â–ˆâ–        | 233/2048 [00:03<00:11, 157.47it/s, est. speed input: 5091.56 toks/s, output: 1939.63 toks/s]Processed prompts:  12%|â–ˆâ–        | 254/2048 [00:03<00:11, 162.97it/s, est. speed input: 5385.29 toks/s, output: 2051.53 toks/s]Processed prompts:  13%|â–ˆâ–Ž        | 276/2048 [00:04<00:10, 168.95it/s, est. speed input: 5680.73 toks/s, output: 2164.08 toks/s]Processed prompts:  15%|â–ˆâ–        | 297/2048 [00:04<00:10, 171.70it/s, est. speed input: 5941.89 toks/s, output: 2263.57 toks/s]Processed prompts:  16%|â–ˆâ–Œ        | 318/2048 [00:04<00:09, 173.33it/s, est. speed input: 6187.54 toks/s, output: 2357.15 toks/s]Processed prompts:  17%|â–ˆâ–‹        | 338/2048 [00:04<00:09, 172.30it/s, est. speed input: 6401.99 toks/s, output: 2438.85 toks/s]Processed prompts:  18%|â–ˆâ–Š        | 359/2048 [00:04<00:09, 174.05it/s, est. speed input: 6623.80 toks/s, output: 2523.34 toks/s]Processed prompts:  19%|â–ˆâ–Š        | 379/2048 [00:04<00:09, 173.05it/s, est. speed input: 6817.31 toks/s, output: 2597.06 toks/s]Processed prompts:  19%|â–ˆâ–‰        | 399/2048 [00:04<00:09, 172.45it/s, est. speed input: 7001.74 toks/s, output: 2667.32 toks/s]Processed prompts:  20%|â–ˆâ–ˆ        | 418/2048 [00:04<00:09, 169.02it/s, est. speed input: 7158.62 toks/s, output: 2727.08 toks/s]Processed prompts:  21%|â–ˆâ–ˆâ–       | 438/2048 [00:05<00:09, 168.78it/s, est. speed input: 7323.64 toks/s, output: 2789.95 toks/s]Processed prompts:  22%|â–ˆâ–ˆâ–       | 457/2048 [00:05<00:09, 167.61it/s, est. speed input: 7469.88 toks/s, output: 2845.66 toks/s]Processed prompts:  23%|â–ˆâ–ˆâ–Ž       | 476/2048 [00:05<00:09, 166.12it/s, est. speed input: 7607.48 toks/s, output: 2898.08 toks/s]Processed prompts:  24%|â–ˆâ–ˆâ–       | 494/2048 [00:05<00:09, 162.44it/s, est. speed input: 7723.22 toks/s, output: 2942.17 toks/s]Processed prompts:  25%|â–ˆâ–ˆâ–Œ       | 513/2048 [00:05<00:09, 162.33it/s, est. speed input: 7849.02 toks/s, output: 2990.09 toks/s]Processed prompts:  26%|â–ˆâ–ˆâ–Œ       | 531/2048 [00:05<00:09, 159.92it/s, est. speed input: 7955.32 toks/s, output: 3030.59 toks/s]Processed prompts:  27%|â–ˆâ–ˆâ–‹       | 549/2048 [00:05<00:09, 158.21it/s, est. speed input: 8057.28 toks/s, output: 3069.43 toks/s]Processed prompts:  28%|â–ˆâ–ˆâ–Š       | 567/2048 [00:05<00:09, 156.84it/s, est. speed input: 8154.52 toks/s, output: 3106.47 toks/s]Processed prompts:  29%|â–ˆâ–ˆâ–Š       | 585/2048 [00:05<00:09, 155.51it/s, est. speed input: 8246.68 toks/s, output: 3141.58 toks/s]Processed prompts:  29%|â–ˆâ–ˆâ–‰       | 602/2048 [00:06<00:09, 152.05it/s, est. speed input: 8321.49 toks/s, output: 3170.08 toks/s]Processed prompts:  30%|â–ˆâ–ˆâ–ˆ       | 619/2048 [00:06<00:09, 150.09it/s, est. speed input: 8395.06 toks/s, output: 3198.11 toks/s]Processed prompts:  31%|â–ˆâ–ˆâ–ˆ       | 636/2048 [00:06<00:09, 148.64it/s, est. speed input: 8465.66 toks/s, output: 3225.00 toks/s]Processed prompts:  32%|â–ˆâ–ˆâ–ˆâ–      | 651/2048 [00:06<00:09, 141.53it/s, est. speed input: 8503.93 toks/s, output: 3239.59 toks/s]Processed prompts:  33%|â–ˆâ–ˆâ–ˆâ–Ž      | 666/2048 [00:06<00:10, 137.27it/s, est. speed input: 8543.35 toks/s, output: 3254.61 toks/s]Processed prompts:  33%|â–ˆâ–ˆâ–ˆâ–Ž      | 680/2048 [00:06<00:10, 131.39it/s, est. speed input: 8567.42 toks/s, output: 3263.78 toks/s]Processed prompts:  34%|â–ˆâ–ˆâ–ˆâ–      | 694/2048 [00:06<00:10, 127.62it/s, est. speed input: 8591.97 toks/s, output: 3273.12 toks/s]Processed prompts:  35%|â–ˆâ–ˆâ–ˆâ–      | 711/2048 [00:06<00:10, 132.49it/s, est. speed input: 8651.74 toks/s, output: 3295.89 toks/s]Processed prompts:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 728/2048 [00:07<00:09, 135.84it/s, est. speed input: 8709.26 toks/s, output: 3317.81 toks/s]Processed prompts:  36%|â–ˆâ–ˆâ–ˆâ–‹      | 746/2048 [00:07<00:09, 140.89it/s, est. speed input: 8777.28 toks/s, output: 3343.72 toks/s]Processed prompts:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 763/2048 [00:07<00:09, 141.70it/s, est. speed input: 8830.83 toks/s, output: 3364.12 toks/s]Processed prompts:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 781/2048 [00:07<00:08, 144.80it/s, est. speed input: 8894.08 toks/s, output: 3388.21 toks/s]Processed prompts:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 799/2048 [00:07<00:08, 147.12it/s, est. speed input: 8955.78 toks/s, output: 3411.72 toks/s]Processed prompts:  40%|â–ˆâ–ˆâ–ˆâ–‰      | 816/2048 [00:07<00:08, 146.07it/s, est. speed input: 9004.12 toks/s, output: 3430.14 toks/s]Processed prompts:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 834/2048 [00:08<00:16, 73.33it/s, est. speed input: 8615.24 toks/s, output: 3281.99 toks/s] Processed prompts:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 869/2048 [00:08<00:10, 114.33it/s, est. speed input: 8860.69 toks/s, output: 3375.49 toks/s]Processed prompts:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 905/2048 [00:08<00:07, 156.29it/s, est. speed input: 9110.82 toks/s, output: 3470.78 toks/s]Processed prompts:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 941/2048 [00:08<00:05, 195.11it/s, est. speed input: 9355.35 toks/s, output: 3563.93 toks/s]Processed prompts:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 968/2048 [00:08<00:05, 207.49it/s, est. speed input: 9501.11 toks/s, output: 3619.47 toks/s]Processed prompts:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 994/2048 [00:08<00:04, 210.97it/s, est. speed input: 9623.71 toks/s, output: 3666.17 toks/s]Processed prompts:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 1019/2048 [00:08<00:06, 165.52it/s, est. speed input: 9606.81 toks/s, output: 3658.92 toks/s]Processed prompts:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 1040/2048 [00:09<00:05, 168.45it/s, est. speed input: 9678.91 toks/s, output: 3685.51 toks/s]Processed prompts:  52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1060/2048 [00:09<00:05, 168.31it/s, est. speed input: 9738.68 toks/s, output: 3707.48 toks/s]Processed prompts:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 1079/2048 [00:09<00:05, 166.58it/s, est. speed input: 9789.53 toks/s, output: 3726.09 toks/s]Processed prompts:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 1097/2048 [00:09<00:05, 162.73it/s, est. speed input: 9829.48 toks/s, output: 3740.62 toks/s]Processed prompts:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1115/2048 [00:09<00:05, 159.59it/s, est. speed input: 9867.69 toks/s, output: 3754.51 toks/s]Processed prompts:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 1132/2048 [00:09<00:05, 155.17it/s, est. speed input: 9896.94 toks/s, output: 3765.04 toks/s]Processed prompts:  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 1148/2048 [00:09<00:06, 149.56it/s, est. speed input: 9916.87 toks/s, output: 3772.06 toks/s]Processed prompts:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 1164/2048 [00:09<00:06, 145.65it/s, est. speed input: 9936.65 toks/s, output: 3779.05 toks/s]Processed prompts:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 1179/2048 [00:09<00:06, 140.16it/s, est. speed input: 9946.88 toks/s, output: 3782.45 toks/s]Processed prompts:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 1194/2048 [00:10<00:06, 136.44it/s, est. speed input: 9957.37 toks/s, output: 3785.96 toks/s]Processed prompts:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 1208/2048 [00:10<00:06, 131.22it/s, est. speed input: 9959.11 toks/s, output: 3786.18 toks/s]Processed prompts:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 1226/2048 [00:10<00:05, 137.46it/s, est. speed input: 9993.09 toks/s, output: 3798.55 toks/s]Processed prompts:  61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 1243/2048 [00:10<00:05, 139.60it/s, est. speed input: 10018.99 toks/s, output: 3807.89 toks/s]Processed prompts:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1261/2048 [00:10<00:05, 142.86it/s, est. speed input: 10050.30 toks/s, output: 3819.27 toks/s]Processed prompts:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1279/2048 [00:10<00:05, 145.89it/s, est. speed input: 10082.85 toks/s, output: 3831.13 toks/s]Processed prompts:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 1296/2048 [00:10<00:05, 145.45it/s, est. speed input: 10106.75 toks/s, output: 3839.75 toks/s]Processed prompts:  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1314/2048 [00:10<00:04, 147.41it/s, est. speed input: 10137.25 toks/s, output: 3850.85 toks/s]Processed prompts:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1332/2048 [00:11<00:04, 149.23it/s, est. speed input: 10168.19 toks/s, output: 3862.13 toks/s]Processed prompts:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1349/2048 [00:11<00:04, 147.43it/s, est. speed input: 10189.54 toks/s, output: 3869.80 toks/s]Processed prompts:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 1367/2048 [00:11<00:04, 149.04it/s, est. speed input: 10218.80 toks/s, output: 3880.46 toks/s]Processed prompts:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 1384/2048 [00:11<00:04, 147.60it/s, est. speed input: 10239.91 toks/s, output: 3888.07 toks/s]Processed prompts:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 1402/2048 [00:11<00:04, 149.11it/s, est. speed input: 10267.94 toks/s, output: 3898.28 toks/s]Processed prompts:  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 1420/2048 [00:11<00:04, 150.44it/s, est. speed input: 10296.01 toks/s, output: 3908.52 toks/s]Processed prompts:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 1437/2048 [00:11<00:04, 148.46it/s, est. speed input: 10315.44 toks/s, output: 3915.51 toks/s]Processed prompts:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 1455/2048 [00:11<00:03, 149.61it/s, est. speed input: 10341.64 toks/s, output: 3925.05 toks/s]Processed prompts:  72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 1472/2048 [00:11<00:03, 147.89it/s, est. speed input: 10360.26 toks/s, output: 3931.75 toks/s]Processed prompts:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 1490/2048 [00:12<00:03, 150.43it/s, est. speed input: 10388.24 toks/s, output: 3941.99 toks/s]Processed prompts:  74%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 1525/2048 [00:12<00:03, 170.56it/s, est. speed input: 10484.29 toks/s, output: 3977.71 toks/s]Processed prompts:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 1561/2048 [00:12<00:02, 199.71it/s, est. speed input: 10617.16 toks/s, output: 4027.40 toks/s]Processed prompts:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 1596/2048 [00:12<00:02, 221.80it/s, est. speed input: 10747.30 toks/s, output: 4076.08 toks/s]Processed prompts:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 1631/2048 [00:12<00:01, 241.17it/s, est. speed input: 10880.17 toks/s, output: 4125.82 toks/s]Processed prompts:  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 1667/2048 [00:12<00:01, 262.33it/s, est. speed input: 11023.55 toks/s, output: 4179.53 toks/s]Processed prompts:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 1702/2048 [00:12<00:01, 279.49it/s, est. speed input: 11162.63 toks/s, output: 4231.65 toks/s]Processed prompts:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 1737/2048 [00:12<00:01, 297.67it/s, est. speed input: 11305.38 toks/s, output: 4285.16 toks/s]Processed prompts:  87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 1790/2048 [00:13<00:00, 327.25it/s, est. speed input: 11529.98 toks/s, output: 4369.41 toks/s]Processed prompts:  90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 1843/2048 [00:13<00:00, 373.99it/s, est. speed input: 11777.96 toks/s, output: 4462.54 toks/s]Processed prompts:  93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 1914/2048 [00:13<00:00, 441.80it/s, est. speed input: 12125.44 toks/s, output: 4593.10 toks/s]Processed prompts:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 2002/2048 [00:13<00:00, 555.23it/s, est. speed input: 12589.52 toks/s, output: 4767.60 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:13<00:00, 555.23it/s, est. speed input: 12852.07 toks/s, output: 4866.38 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:13<00:00, 152.07it/s, est. speed input: 12852.07 toks/s, output: 4866.38 toks/s]
âœ“ Data parallelism performance test results:
  Number of prompts: 2048
  Baseline time: 13.92s
  Data parallel time: 11.47s
  Speedup: 1.21x
  Baseline throughput: 147.16 prompts/s
  Data parallel throughput: 178.63 prompts/s
INFO 02-06 21:33:22 [utils.py:282] non-default args: {'max_model_len': 1024, 'tensor_parallel_size': 4, 'gpu_memory_utilization': 0.8, 'max_num_batched_tokens': 1024, 'max_num_seqs': 1024, 'disable_log_stats': True, 'additional_config': {'sharding': {'sharding_strategy': {'enable_dp_attention': 1}}}, 'async_scheduling': False, 'model': 'Qwen/Qwen2.5-1.5B-Instruct'}
INFO 02-06 21:33:23 [model.py:541] Resolved architecture: Qwen2ForCausalLM
INFO 02-06 21:33:23 [model.py:1558] Using max model len 1024
INFO 02-06 21:33:23 [scheduler.py:226] Chunked prefill is enabled with max_num_batched_tokens=1024.
INFO 02-06 21:33:23 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=4, sharding_strategy=ShardingStrategy(tensor_parallelism=2, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=2), device_indexes=None)
INFO 02-06 21:33:23 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:23 [core.py:96] Initializing a V1 LLM engine (v0.11.1rc6.dev215+gd9ab1ad9d.d20251114) with config: model='Qwen/Qwen2.5-1.5B-Instruct', speculative_config=None, tokenizer='Qwen/Qwen2.5-1.5B-Instruct', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=1024, download_dir=None, load_format=auto, tensor_parallel_size=4, pipeline_parallel_size=1, data_parallel_size=1, disable_custom_all_reduce=True, quantization=None, enforce_eager=False, enable_return_routed_experts=False, kv_cache_dtype=auto, device_config=None, structured_outputs_config=StructuredOutputsConfig(backend='auto', disable_fallback=False, disable_any_whitespace=False, disable_additional_properties=False, reasoning_parser='', reasoning_parser_plugin='', enable_in_reasoning=False), observability_config=ObservabilityConfig(show_hidden_metrics_for_version=None, otlp_traces_endpoint=None, collect_detailed_traces=None, kv_cache_metrics=False, kv_cache_metrics_sample=0.01, cudagraph_metrics=False, enable_layerwise_nvtx_tracing=False, enable_mfu_metrics=False, enable_mm_processor_stats=False, enable_logging_iteration_details=False), seed=0, served_model_name=Qwen/Qwen2.5-1.5B-Instruct, enable_prefix_caching=True, enable_chunked_prefill=True, pooler_config=None, compilation_config={'level': None, 'mode': <CompilationMode.DYNAMO_TRACE_ONCE: 2>, 'debug_dump_path': None, 'cache_dir': '', 'compile_cache_save_format': 'binary', 'backend': 'openxla', 'custom_ops': ['all'], 'splitting_ops': [], 'compile_mm_encoder': False, 'compile_sizes': None, 'compile_ranges_split_points': [1024], 'inductor_compile_config': {'enable_auto_functionalized_v2': False}, 'inductor_passes': {}, 'cudagraph_mode': <CUDAGraphMode.NONE: 0>, 'cudagraph_num_of_warmups': 0, 'cudagraph_capture_sizes': None, 'cudagraph_copy_inputs': False, 'cudagraph_specialize_lora': True, 'use_inductor_graph_partition': False, 'pass_config': {'fuse_norm_quant': True, 'fuse_act_quant': True, 'fuse_attn_quant': False, 'eliminate_noops': True, 'enable_sp': False, 'fuse_gemm_comms': False, 'fuse_allreduce_rms': False, 'fuse_act_padding': False}, 'max_cudagraph_capture_size': None, 'dynamic_shapes_config': {'type': <DynamicShapesType.BACKED: 'backed'>, 'evaluate_guards': False, 'assume_32_bit_indexing': False}, 'local_cache_dir': None, 'static_all_moe_layers': []}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [parallel_state.py:1234] world_size=1 rank=0 local_rank=0 distributed_init_method=file:///tmp/tmp3iw_yges backend=gloo
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [parallel_state.py:1445] rank 0 in world size 1 is assigned as DP rank 0, PP rank 0, PCP rank 0, TP rank 0, EP rank N/A
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [tpu_runner.py:302] Creating new model mesh | devices=4, num_slices=1
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [tpu_runner.py:297] Init mesh | mesh=Mesh('data': 1, 'attn_dp': 2, 'expert': 1, 'model': 2, axis_types=(Auto, Auto, Auto, Auto))
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [utils.py:94] Prepared token paddings: [16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [utils.py:60] Prepared request paddings: [8, 16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [compilation_manager.py:52] Enabling JAX compile cache.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [tpu_worker.py:247] Init worker | rank=0 | is_first_rank=True | is_last_rank=True | topology_order_id=0 | is_driver_worker=True | hbm=[(0.0, 31.25), (0.0, 31.25), (0.0, 31.25), (0.0, 31.25)]GiB |self.devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0)] | total devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)] | local_devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [model_loader.py:379] Loading model with MODEL_IMPL_TYPE=vllm
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [tpu_platform.py:65] Cannot use None backend on TPU. Setting to FLASH_ATTN.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [tpu_platform.py:68] Using FLASH_ATTN backend.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:34 [weight_utils.py:567] No model.safetensors.index.json found in remote.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.20it/s]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.20it/s]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m 
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:35 [default_loader.py:291] Loading weights took 0.92 seconds
[0;36m(EngineCore_DP0 pid=3953963)[0;0m WARNING 02-06 21:33:35 [unquantized.py:127] Bias might return incorrect value.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:40 [tpu_runner.py:529] Init model | hbm=[(1.34, 31.25), (1.34, 31.25), (1.34, 31.25), (1.34, 31.25)]GiB
[0;36m(EngineCore_DP0 pid=3953963)[0;0m WARNING 02-06 21:33:40 [kv_cache_manager.py:156] Compilation num_layers = 28
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:40 [tpu_worker.py:281] Memory statistics | total_hbm_limit_gb=124.98GiB | total_hbm_limit_cap_gb=99.99GiB | total_hbm_used_gb=5.35GiB | total_hbm_avail_gb=94.64GiB
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:40 [kv_cache_utils.py:1307] GPU KV cache size: 3,544,128 tokens
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:40 [kv_cache_utils.py:1312] Maximum concurrency for 1,024 tokens per request: 3461.06x
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:40 [compilation_manager.py:502] Compiling sampling with different input shapes.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:41 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:41 [compilation_manager.py:85] Compilation finished in 0.92 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:41 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:42 [compilation_manager.py:85] Compilation finished in 0.90 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:42 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:42 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:42 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:43 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:43 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:44 [compilation_manager.py:85] Compilation finished in 0.98 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:44 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:45 [compilation_manager.py:85] Compilation finished in 0.96 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:45 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:45 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:45 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:45 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:46 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:47 [compilation_manager.py:85] Compilation finished in 0.97 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:47 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:48 [compilation_manager.py:85] Compilation finished in 0.95 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:48 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:48 [compilation_manager.py:85] Compilation finished in 0.44 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:48 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:49 [compilation_manager.py:85] Compilation finished in 0.45 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:49 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:50 [compilation_manager.py:85] Compilation finished in 1.01 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:50 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:51 [compilation_manager.py:85] Compilation finished in 1.01 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:51 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:52 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:52 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:53 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:53 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:54 [compilation_manager.py:85] Compilation finished in 1.07 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:54 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:55 [compilation_manager.py:85] Compilation finished in 1.03 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:55 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:55 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:55 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:56 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:56 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:57 [compilation_manager.py:85] Compilation finished in 1.08 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:57 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:58 [compilation_manager.py:85] Compilation finished in 1.05 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:58 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:58 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:58 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:58 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:33:59 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:00 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:85] Compilation finished in 0.18 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:01 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:575] Compiling gather_logprobs with different input shapes.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:85] Compilation finished in 0.32 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:85] Compilation finished in 0.33 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:02 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:03 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:03 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:04 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:05 [kv_cache_manager.py:272] Init kv-cache | num_layers=28 | shape=(num_blocks, (64, 2, 2, 128)) | num_blocks=[np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376), np.int64(55376)] | sharding=NamedSharding(mesh=Mesh('data': 1, 'attn_dp': 2, 'expert': 1, 'model': 2, axis_types=(Auto, Auto, Auto, Auto)), spec=PartitionSpec(('data', 'attn_dp'), None, ('model', 'expert')), memory_kind=device) | dtype=bfloat16 | hbm=[(25.03, 31.25), (25.03, 31.25), (25.03, 31.25), (25.03, 31.25)]Gb
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:05 [compilation_manager.py:90] Precompile all the subgraphs with possible input shapes.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:05 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m WARNING 02-06 21:34:06 [tuned_block_sizes.py:4368] Couldn`t find tuned sizes for the RPA v3 kernel with ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None')
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:06 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=8
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:10 [compilation_manager.py:85] Compilation finished in 4.69 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:10 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:10 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=16
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:15 [compilation_manager.py:85] Compilation finished in 4.72 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:15 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:15 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=32
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:20 [compilation_manager.py:85] Compilation finished in 5.33 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:20 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:25 [compilation_manager.py:85] Compilation finished in 5.14 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:25 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:31 [compilation_manager.py:85] Compilation finished in 5.71 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:31 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 512}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:37 [compilation_manager.py:85] Compilation finished in 6.21 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:37 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 1024}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:46 [compilation_manager.py:85] Compilation finished in 8.27 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:46 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 2048}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:85] Compilation finished in 9.30 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:432] Compiling select_from_array with different input shapes.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:411] Compiling select_from_array for worker0 select all logits.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:55 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:56 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:57 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:85] Compilation finished in 0.13 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:85] Compilation finished in 0.15 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:85] Compilation finished in 0.33 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:58 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:85] Compilation finished in 0.15 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:34:59 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:00 [compilation_manager.py:85] Compilation finished in 0.26 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:00 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:00 [compilation_manager.py:85] Compilation finished in 0.41 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:00 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:00 [compilation_manager.py:85] Compilation finished in 0.37 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:00 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:01 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:01 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:01 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:01 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:01 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:01 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:02 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:02 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:02 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:02 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:02 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:02 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:03 [compilation_manager.py:85] Compilation finished in 0.48 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:03 [compilation_manager.py:85] Compilation finished in 0.48 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:03 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:03 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 2048}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:480] Compiling compute_logits with different input shapes.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:04 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:05 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:05 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:05 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:05 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:05 [compilation_manager.py:85] Compilation finished in 0.38 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:05 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:06 [compilation_manager.py:85] Compilation finished in 0.49 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:06 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:06 [compilation_manager.py:85] Compilation finished in 0.61 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:06 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:07 [compilation_manager.py:85] Compilation finished in 0.70 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:07 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:07 [compilation_manager.py:85] Compilation finished in 0.02 [secs].
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:07 [compilation_manager.py:895] Compiling structured_decoding with different input shapes.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m WARNING 02-06 21:35:07 [compilation_manager.py:898] Structured decoding precompilation skipped since structured decoding is not supported with DP.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:07 [core.py:272] init engine (profile, create kv cache, warmup model) took 86.70 seconds
[0;36m(EngineCore_DP0 pid=3953963)[0;0m WARNING 02-06 21:35:07 [scheduler.py:168] Using custom scheduler class <class 'tpu_inference.core.sched.dp_scheduler.DPScheduler'>. This scheduler interface is not public and compatibility may not be maintained.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:08 [dp_scheduler.py:350] DPScheduler (Async = False) started 2 worker processes with cloudpickle. Per-rank limits: max_seqs=1024, max_tokens=1024
[0;36m(EngineCore_DP0 pid=3953963)[0;0m WARNING 02-06 21:35:09 [vllm.py:685] Inductor compilation was disabled by user settings, optimizations settings that are only active during inductor compilation will be ignored.
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:09 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=4, sharding_strategy=ShardingStrategy(tensor_parallelism=2, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=2), device_indexes=None)
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:09 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
INFO 02-06 21:35:09 [llm.py:343] Supported tasks: ['generate']
Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]Adding requests:  20%|â–ˆâ–ˆ        | 418/2048 [00:00<00:00, 4173.98it/s]Adding requests:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 850/2048 [00:00<00:00, 4257.20it/s]Adding requests:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1276/2048 [00:00<00:00, 4252.39it/s]Adding requests:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 1705/2048 [00:00<00:00, 4263.55it/s]Adding requests: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:00<00:00, 4243.84it/s]
Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]Processed prompts:   0%|          | 1/2048 [00:02<1:33:24,  2.74s/it, est. speed input: 30.32 toks/s, output: 11.69 toks/s]Processed prompts:   2%|â–         | 49/2048 [00:02<01:23, 24.07it/s, est. speed input: 1443.50 toks/s, output: 551.24 toks/s]Processed prompts:   5%|â–         | 95/2048 [00:02<00:37, 52.57it/s, est. speed input: 2700.18 toks/s, output: 1029.92 toks/s]Processed prompts:   7%|â–‹         | 141/2048 [00:03<00:21, 87.29it/s, est. speed input: 3887.73 toks/s, output: 1477.17 toks/s]Processed prompts:   9%|â–‰         | 187/2048 [00:03<00:14, 127.25it/s, est. speed input: 4996.91 toks/s, output: 1894.29 toks/s]Processed prompts:  11%|â–ˆ         | 229/2048 [00:03<00:10, 166.48it/s, est. speed input: 5938.91 toks/s, output: 2248.52 toks/s]Processed prompts:  13%|â–ˆâ–Ž        | 270/2048 [00:03<00:11, 150.12it/s, est. speed input: 6363.78 toks/s, output: 2407.31 toks/s]Processed prompts:  15%|â–ˆâ–        | 302/2048 [00:03<00:10, 170.43it/s, est. speed input: 6897.46 toks/s, output: 2607.86 toks/s]Processed prompts:  17%|â–ˆâ–‹        | 355/2048 [00:03<00:07, 213.49it/s, est. speed input: 7802.51 toks/s, output: 2948.15 toks/s]Processed prompts:  20%|â–ˆâ–ˆ        | 413/2048 [00:03<00:06, 259.94it/s, est. speed input: 8758.66 toks/s, output: 3307.73 toks/s]Processed prompts:  23%|â–ˆâ–ˆâ–Ž       | 471/2048 [00:04<00:05, 296.49it/s, est. speed input: 9644.31 toks/s, output: 3640.78 toks/s]Processed prompts:  26%|â–ˆâ–ˆâ–Œ       | 525/2048 [00:04<00:04, 319.31it/s, est. speed input: 10398.76 toks/s, output: 3924.48 toks/s]Processed prompts:  28%|â–ˆâ–ˆâ–Š       | 579/2048 [00:04<00:04, 336.14it/s, est. speed input: 11102.79 toks/s, output: 4189.23 toks/s]Processed prompts:  31%|â–ˆâ–ˆâ–ˆ       | 631/2048 [00:04<00:04, 346.94it/s, est. speed input: 11734.31 toks/s, output: 4426.69 toks/s]Processed prompts:  33%|â–ˆâ–ˆâ–ˆâ–Ž      | 681/2048 [00:04<00:03, 347.03it/s, est. speed input: 12278.46 toks/s, output: 4631.27 toks/s]Processed prompts:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 731/2048 [00:04<00:03, 349.17it/s, est. speed input: 12797.97 toks/s, output: 4826.59 toks/s]Processed prompts:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 783/2048 [00:04<00:03, 353.73it/s, est. speed input: 13318.04 toks/s, output: 5022.14 toks/s]Processed prompts:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 835/2048 [00:05<00:05, 216.48it/s, est. speed input: 13017.71 toks/s, output: 4908.37 toks/s]Processed prompts:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 871/2048 [00:05<00:05, 232.87it/s, est. speed input: 13297.61 toks/s, output: 5013.59 toks/s]Processed prompts:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 923/2048 [00:05<00:04, 264.02it/s, est. speed input: 13742.65 toks/s, output: 5180.95 toks/s]Processed prompts:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 977/2048 [00:05<00:03, 292.48it/s, est. speed input: 14191.78 toks/s, output: 5349.86 toks/s]Processed prompts:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 1029/2048 [00:05<00:03, 306.30it/s, est. speed input: 14574.66 toks/s, output: 5492.00 toks/s]Processed prompts:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 1081/2048 [00:06<00:03, 321.43it/s, est. speed input: 14962.13 toks/s, output: 5634.57 toks/s]Processed prompts:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 1135/2048 [00:06<00:02, 335.07it/s, est. speed input: 15353.27 toks/s, output: 5778.54 toks/s]Processed prompts:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 1187/2048 [00:06<00:02, 346.25it/s, est. speed input: 15718.37 toks/s, output: 5912.98 toks/s]Processed prompts:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 1239/2048 [00:06<00:02, 358.82it/s, est. speed input: 16082.47 toks/s, output: 6047.15 toks/s]Processed prompts:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 1291/2048 [00:06<00:02, 368.85it/s, est. speed input: 16434.19 toks/s, output: 6176.79 toks/s]Processed prompts:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1345/2048 [00:06<00:01, 379.66it/s, est. speed input: 16794.88 toks/s, output: 6309.79 toks/s]Processed prompts:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 1397/2048 [00:06<00:01, 383.74it/s, est. speed input: 17119.04 toks/s, output: 6429.27 toks/s]Processed prompts:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 1449/2048 [00:07<00:01, 386.01it/s, est. speed input: 17429.20 toks/s, output: 6543.56 toks/s]Processed prompts:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 1501/2048 [00:07<00:01, 388.54it/s, est. speed input: 17730.57 toks/s, output: 6654.63 toks/s]Processed prompts:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 1555/2048 [00:07<00:01, 403.71it/s, est. speed input: 18068.62 toks/s, output: 6779.47 toks/s]Processed prompts:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 1607/2048 [00:07<00:01, 422.03it/s, est. speed input: 18402.18 toks/s, output: 6902.75 toks/s]Processed prompts:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 1677/2048 [00:07<00:00, 461.25it/s, est. speed input: 18888.05 toks/s, output: 7082.61 toks/s]Processed prompts:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 1747/2048 [00:07<00:00, 517.30it/s, est. speed input: 19416.93 toks/s, output: 7278.67 toks/s]Processed prompts:  90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 1851/2048 [00:07<00:00, 631.60it/s, est. speed input: 20279.09 toks/s, output: 7598.68 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:07<00:00, 631.60it/s, est. speed input: 22219.46 toks/s, output: 8320.14 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:07<00:00, 260.00it/s, est. speed input: 22219.46 toks/s, output: 8320.14 toks/s]
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:18 [dp_scheduler.py:226] Rank 1: Shutting down
[0;36m(EngineCore_DP0 pid=3953963)[0;0m INFO 02-06 21:35:18 [dp_scheduler.py:226] Rank 0: Shutting down
INFO 02-06 21:35:33 [utils.py:282] non-default args: {'max_model_len': 1024, 'tensor_parallel_size': 2, 'gpu_memory_utilization': 0.8, 'max_num_batched_tokens': 2048, 'max_num_seqs': 2048, 'disable_log_stats': True, 'async_scheduling': False, 'model': 'Qwen/Qwen2.5-1.5B-Instruct'}
INFO 02-06 21:35:33 [model.py:541] Resolved architecture: Qwen2ForCausalLM
INFO 02-06 21:35:33 [model.py:1558] Using max model len 1024
INFO 02-06 21:35:33 [scheduler.py:226] Chunked prefill is enabled with max_num_batched_tokens=2048.
INFO 02-06 21:35:33 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=2, sharding_strategy=ShardingStrategy(tensor_parallelism=2, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=1), device_indexes=None)
INFO 02-06 21:35:33 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:33 [core.py:96] Initializing a V1 LLM engine (v0.11.1rc6.dev215+gd9ab1ad9d.d20251114) with config: model='Qwen/Qwen2.5-1.5B-Instruct', speculative_config=None, tokenizer='Qwen/Qwen2.5-1.5B-Instruct', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=1024, download_dir=None, load_format=auto, tensor_parallel_size=2, pipeline_parallel_size=1, data_parallel_size=1, disable_custom_all_reduce=True, quantization=None, enforce_eager=False, enable_return_routed_experts=False, kv_cache_dtype=auto, device_config=None, structured_outputs_config=StructuredOutputsConfig(backend='auto', disable_fallback=False, disable_any_whitespace=False, disable_additional_properties=False, reasoning_parser='', reasoning_parser_plugin='', enable_in_reasoning=False), observability_config=ObservabilityConfig(show_hidden_metrics_for_version=None, otlp_traces_endpoint=None, collect_detailed_traces=None, kv_cache_metrics=False, kv_cache_metrics_sample=0.01, cudagraph_metrics=False, enable_layerwise_nvtx_tracing=False, enable_mfu_metrics=False, enable_mm_processor_stats=False, enable_logging_iteration_details=False), seed=0, served_model_name=Qwen/Qwen2.5-1.5B-Instruct, enable_prefix_caching=True, enable_chunked_prefill=True, pooler_config=None, compilation_config={'level': None, 'mode': <CompilationMode.DYNAMO_TRACE_ONCE: 2>, 'debug_dump_path': None, 'cache_dir': '', 'compile_cache_save_format': 'binary', 'backend': 'openxla', 'custom_ops': ['all'], 'splitting_ops': [], 'compile_mm_encoder': False, 'compile_sizes': None, 'compile_ranges_split_points': [2048], 'inductor_compile_config': {'enable_auto_functionalized_v2': False}, 'inductor_passes': {}, 'cudagraph_mode': <CUDAGraphMode.NONE: 0>, 'cudagraph_num_of_warmups': 0, 'cudagraph_capture_sizes': None, 'cudagraph_copy_inputs': False, 'cudagraph_specialize_lora': True, 'use_inductor_graph_partition': False, 'pass_config': {'fuse_norm_quant': True, 'fuse_act_quant': True, 'fuse_attn_quant': False, 'eliminate_noops': True, 'enable_sp': False, 'fuse_gemm_comms': False, 'fuse_allreduce_rms': False, 'fuse_act_padding': False}, 'max_cudagraph_capture_size': None, 'dynamic_shapes_config': {'type': <DynamicShapesType.BACKED: 'backed'>, 'evaluate_guards': False, 'assume_32_bit_indexing': False}, 'local_cache_dir': None, 'static_all_moe_layers': []}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [parallel_state.py:1234] world_size=1 rank=0 local_rank=0 distributed_init_method=file:///tmp/tmpj02g6g1x backend=gloo
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [parallel_state.py:1445] rank 0 in world size 1 is assigned as DP rank 0, PP rank 0, PCP rank 0, TP rank 0, EP rank N/A
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [tpu_runner.py:302] Creating new model mesh | devices=2, num_slices=1
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [tpu_runner.py:297] Init mesh | mesh=Mesh('data': 1, 'attn_dp': 1, 'expert': 1, 'model': 2, axis_types=(Auto, Auto, Auto, Auto))
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [utils.py:94] Prepared token paddings: [16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [utils.py:60] Prepared request paddings: [8, 16, 32, 64, 128, 256, 512, 1024, 2048]
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [compilation_manager.py:52] Enabling JAX compile cache.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [tpu_worker.py:247] Init worker | rank=0 | is_first_rank=True | is_last_rank=True | topology_order_id=0 | is_driver_worker=True | hbm=[(0.0, 31.25), (0.0, 31.25)]GiB |self.devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0)] | total devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)] | local_devices=[TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)]
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [model_loader.py:379] Loading model with MODEL_IMPL_TYPE=vllm
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [tpu_platform.py:65] Cannot use None backend on TPU. Setting to FLASH_ATTN.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:44 [tpu_platform.py:68] Using FLASH_ATTN backend.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:45 [weight_utils.py:567] No model.safetensors.index.json found in remote.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
[0;36m(EngineCore_DP0 pid=3963005)[0;0m Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.06s/it]
[0;36m(EngineCore_DP0 pid=3963005)[0;0m Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.06s/it]
[0;36m(EngineCore_DP0 pid=3963005)[0;0m 
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:46 [default_loader.py:291] Loading weights took 1.15 seconds
[0;36m(EngineCore_DP0 pid=3963005)[0;0m WARNING 02-06 21:35:46 [unquantized.py:127] Bias might return incorrect value.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [tpu_runner.py:529] Init model | hbm=[(1.45, 31.25), (1.45, 31.25)]GiB
[0;36m(EngineCore_DP0 pid=3963005)[0;0m WARNING 02-06 21:35:51 [kv_cache_manager.py:156] Compilation num_layers = 28
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [tpu_worker.py:281] Memory statistics | total_hbm_limit_gb=62.49GiB | total_hbm_limit_cap_gb=49.99GiB | total_hbm_used_gb=2.89GiB | total_hbm_avail_gb=47.1GiB
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [kv_cache_utils.py:1307] GPU KV cache size: 1,763,904 tokens
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [kv_cache_utils.py:1312] Maximum concurrency for 1,024 tokens per request: 1722.56x
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:502] Compiling sampling with different input shapes.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 8, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:51 [compilation_manager.py:85] Compilation finished in 0.21 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:85] Compilation finished in 0.40 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:52 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 16, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:53 [compilation_manager.py:85] Compilation finished in 0.44 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:53 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:53 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:53 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:53 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:53 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:54 [compilation_manager.py:85] Compilation finished in 0.79 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:54 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 32, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:85] Compilation finished in 0.82 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:55 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 64, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:56 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:56 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:57 [compilation_manager.py:85] Compilation finished in 1.02 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:57 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:58 [compilation_manager.py:85] Compilation finished in 0.99 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:58 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:58 [compilation_manager.py:85] Compilation finished in 0.21 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:58 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 128, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:58 [compilation_manager.py:85] Compilation finished in 0.21 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:58 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:59 [compilation_manager.py:85] Compilation finished in 1.04 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:35:59 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:00 [compilation_manager.py:85] Compilation finished in 1.03 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:00 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:01 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:01 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 256, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:01 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:01 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:02 [compilation_manager.py:85] Compilation finished in 1.09 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:02 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:03 [compilation_manager.py:85] Compilation finished in 1.07 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:03 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 512, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:04 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 1024, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': True}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:85] Compilation finished in 0.18 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:05 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:85] Compilation finished in 0.27 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:75] Precompile worker0 sample --> {'num_reqs': 2048, 'do_sampling': False}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:85] Compilation finished in 0.28 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:575] Compiling gather_logprobs with different input shapes.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:85] Compilation finished in 0.38 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:06 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:07 [compilation_manager.py:85] Compilation finished in 0.41 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:07 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:07 [compilation_manager.py:85] Compilation finished in 0.62 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:07 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:85] Compilation finished in 0.40 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:85] Compilation finished in 0.04 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:75] Precompile worker0 gather_logprobs --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:08 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:10 [kv_cache_manager.py:272] Init kv-cache | num_layers=28 | shape=(num_blocks, (64, 2, 2, 128)) | num_blocks=[np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561), np.int64(27561)] | sharding=NamedSharding(mesh=Mesh('data': 1, 'attn_dp': 1, 'expert': 1, 'model': 2, axis_types=(Auto, Auto, Auto, Auto)), spec=PartitionSpec(('data', 'attn_dp'), None, ('model', 'expert')), memory_kind=device) | dtype=bfloat16 | hbm=[(25.03, 31.25), (25.03, 31.25)]Gb
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:10 [compilation_manager.py:90] Precompile all the subgraphs with possible input shapes.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:10 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m WARNING 02-06 21:36:10 [tuned_block_sizes.py:4368] Couldn`t find tuned sizes for the RPA v3 kernel with ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None')
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:10 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=16
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:12 [compilation_manager.py:85] Compilation finished in 2.16 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:12 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:12 [tuned_block_sizes.py:4389] RPA v3 kernel tuned block sizes for ('TPU v6e', 64, 'q_bfloat16_kv_bfloat16', 'q_head-8_kv_head-1_head-128', 'max_model_len-1024-sw-None'): bkv_p=16, bq=32
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:13 [compilation_manager.py:85] Compilation finished in 1.44 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:13 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:15 [compilation_manager.py:85] Compilation finished in 1.44 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:15 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:16 [compilation_manager.py:85] Compilation finished in 1.46 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:16 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:18 [compilation_manager.py:85] Compilation finished in 1.95 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:18 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:20 [compilation_manager.py:85] Compilation finished in 1.56 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:20 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 1024}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:21 [compilation_manager.py:85] Compilation finished in 1.66 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:21 [compilation_manager.py:75] Precompile worker0 backbone --> {'num_tokens': 2048}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:85] Compilation finished in 1.72 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:432] Compiling select_from_array with different input shapes.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:411] Compiling select_from_array for worker0 select all logits.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 16, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 32, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:23 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.05 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 64, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.06 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 128, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.17 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.07 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:85] Compilation finished in 0.08 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:24 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:85] Compilation finished in 0.10 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:85] Compilation finished in 0.12 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:85] Compilation finished in 0.18 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 256, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:85] Compilation finished in 0.28 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:85] Compilation finished in 0.09 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:25 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:85] Compilation finished in 0.11 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:85] Compilation finished in 0.15 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:85] Compilation finished in 0.20 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 512, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:26 [compilation_manager.py:85] Compilation finished in 0.31 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:85] Compilation finished in 0.14 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:85] Compilation finished in 0.15 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:85] Compilation finished in 0.19 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:27 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:28 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:28 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:28 [compilation_manager.py:85] Compilation finished in 0.35 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:28 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 1024, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:28 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:28 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:85] Compilation finished in 0.23 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:85] Compilation finished in 0.25 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:85] Compilation finished in 0.28 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:29 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:30 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:30 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:30 [compilation_manager.py:85] Compilation finished in 0.45 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:30 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:85] Compilation finished in 0.45 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 1024}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:75] Precompile select_from_array [worker0 select all logits] --> {'array_size': 2048, 'index_size': 2048}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:85] Compilation finished in 0.34 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:480] Compiling compute_logits with different input shapes.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:31 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:85] Compilation finished in 0.22 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:85] Compilation finished in 0.24 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:85] Compilation finished in 0.29 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:32 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:33 [compilation_manager.py:85] Compilation finished in 0.36 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:33 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:33 [compilation_manager.py:85] Compilation finished in 0.48 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:33 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:34 [compilation_manager.py:85] Compilation finished in 0.62 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:34 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:35 [compilation_manager.py:85] Compilation finished in 0.69 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:35 [compilation_manager.py:75] Precompile worker0 compute_logits --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.91 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:895] Compiling structured_decoding with different input shapes.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 8}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.02 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 16}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.02 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 32}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.02 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 64}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 128}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.16 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 256}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:85] Compilation finished in 0.32 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:36 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 512}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:37 [compilation_manager.py:85] Compilation finished in 0.29 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:37 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 1024}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:37 [compilation_manager.py:85] Compilation finished in 0.87 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:37 [compilation_manager.py:75] Precompile structured_decode --> {'num_reqs': 2048}
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:38 [compilation_manager.py:85] Compilation finished in 0.30 [secs].
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:38 [core.py:272] init engine (profile, create kv cache, warmup model) took 47.13 seconds
[0;36m(EngineCore_DP0 pid=3963005)[0;0m WARNING 02-06 21:36:39 [vllm.py:685] Inductor compilation was disabled by user settings, optimizations settings that are only active during inductor compilation will be ignored.
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:39 [tpu_platform.py:125] Initialized sharding configuration: ShardingConfigManager(total_devices=2, sharding_strategy=ShardingStrategy(tensor_parallelism=2, expert_parallelism=1, sequence_parallelism=1, data_parallelism=1, attention_data_parallelism=1), device_indexes=None)
[0;36m(EngineCore_DP0 pid=3963005)[0;0m INFO 02-06 21:36:39 [tpu_platform.py:176] Force using UniProcExecutor for JAX on single host without pipeline parallelism.
INFO 02-06 21:36:39 [llm.py:343] Supported tasks: ['generate']
Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]Adding requests:  20%|â–ˆâ–‰        | 405/2048 [00:00<00:00, 4040.35it/s]Adding requests:  40%|â–ˆâ–ˆâ–ˆâ–‰      | 812/2048 [00:00<00:00, 4054.35it/s]Adding requests:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 1218/2048 [00:00<00:00, 4035.07it/s]Adding requests:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 1622/2048 [00:00<00:00, 4022.03it/s]Adding requests:  99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 2025/2048 [00:00<00:00, 4015.81it/s]Adding requests: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:00<00:00, 4024.85it/s]
Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]Processed prompts:   0%|          | 1/2048 [00:01<44:39,  1.31s/it, est. speed input: 63.41 toks/s, output: 24.45 toks/s]Processed prompts:   1%|â–         | 26/2048 [00:01<01:20, 25.04it/s, est. speed input: 1532.01 toks/s, output: 586.30 toks/s]Processed prompts:   4%|â–Ž         | 74/2048 [00:01<00:24, 79.83it/s, est. speed input: 4063.74 toks/s, output: 1550.57 toks/s]Processed prompts:   6%|â–Œ         | 120/2048 [00:01<00:14, 135.12it/s, est. speed input: 6186.95 toks/s, output: 2354.57 toks/s]Processed prompts:   8%|â–Š         | 165/2048 [00:01<00:10, 187.98it/s, est. speed input: 8015.78 toks/s, output: 3041.54 toks/s]Processed prompts:  10%|â–ˆ         | 210/2048 [00:01<00:07, 239.56it/s, est. speed input: 9662.43 toks/s, output: 3660.15 toks/s]Processed prompts:  12%|â–ˆâ–        | 253/2048 [00:01<00:06, 280.52it/s, est. speed input: 11043.53 toks/s, output: 4178.91 toks/s]Processed prompts:  14%|â–ˆâ–        | 295/2048 [00:02<00:10, 164.37it/s, est. speed input: 10321.07 toks/s, output: 3902.66 toks/s]Processed prompts:  16%|â–ˆâ–‹        | 336/2048 [00:02<00:08, 200.39it/s, est. speed input: 11277.94 toks/s, output: 4262.20 toks/s]Processed prompts:  19%|â–ˆâ–‰        | 395/2048 [00:02<00:06, 250.80it/s, est. speed input: 12560.27 toks/s, output: 4744.10 toks/s]Processed prompts:  22%|â–ˆâ–ˆâ–       | 453/2048 [00:02<00:05, 289.49it/s, est. speed input: 13673.80 toks/s, output: 5162.51 toks/s]Processed prompts:  25%|â–ˆâ–ˆâ–       | 509/2048 [00:02<00:04, 318.63it/s, est. speed input: 14642.35 toks/s, output: 5526.44 toks/s]Processed prompts:  27%|â–ˆâ–ˆâ–‹       | 562/2048 [00:03<00:04, 332.65it/s, est. speed input: 15420.20 toks/s, output: 5818.62 toks/s]Processed prompts:  30%|â–ˆâ–ˆâ–‰       | 614/2048 [00:03<00:04, 343.86it/s, est. speed input: 16123.22 toks/s, output: 6082.72 toks/s]Processed prompts:  32%|â–ˆâ–ˆâ–ˆâ–      | 665/2048 [00:03<00:03, 349.53it/s, est. speed input: 16738.77 toks/s, output: 6313.91 toks/s]Processed prompts:  35%|â–ˆâ–ˆâ–ˆâ–      | 715/2048 [00:03<00:03, 349.13it/s, est. speed input: 17264.17 toks/s, output: 6511.21 toks/s]Processed prompts:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 767/2048 [00:03<00:03, 355.55it/s, est. speed input: 17811.95 toks/s, output: 6716.98 toks/s]Processed prompts:  40%|â–ˆâ–ˆâ–ˆâ–‰      | 819/2048 [00:03<00:03, 357.27it/s, est. speed input: 18300.77 toks/s, output: 6900.58 toks/s]Processed prompts:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 871/2048 [00:03<00:03, 358.71it/s, est. speed input: 18755.32 toks/s, output: 7071.31 toks/s]Processed prompts:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 924/2048 [00:04<00:03, 360.55it/s, est. speed input: 19190.87 toks/s, output: 7234.91 toks/s]Processed prompts:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 961/2048 [00:04<00:05, 188.02it/s, est. speed input: 17760.74 toks/s, output: 6695.41 toks/s]Processed prompts:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 1012/2048 [00:04<00:04, 223.81it/s, est. speed input: 18178.93 toks/s, output: 6851.62 toks/s]Processed prompts:  52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1065/2048 [00:04<00:03, 260.46it/s, est. speed input: 18622.48 toks/s, output: 7014.28 toks/s]Processed prompts:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1118/2048 [00:04<00:03, 292.27it/s, est. speed input: 19040.67 toks/s, output: 7167.63 toks/s]Processed prompts:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 1170/2048 [00:05<00:02, 317.11it/s, est. speed input: 19422.25 toks/s, output: 7307.48 toks/s]Processed prompts:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 1223/2048 [00:05<00:02, 339.07it/s, est. speed input: 19802.03 toks/s, output: 7446.77 toks/s]Processed prompts:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1276/2048 [00:05<00:02, 356.16it/s, est. speed input: 20163.93 toks/s, output: 7579.50 toks/s]Processed prompts:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1328/2048 [00:05<00:01, 366.66it/s, est. speed input: 20491.77 toks/s, output: 7699.66 toks/s]Processed prompts:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 1380/2048 [00:05<00:01, 374.61it/s, est. speed input: 20805.29 toks/s, output: 7814.57 toks/s]Processed prompts:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 1433/2048 [00:05<00:01, 382.13it/s, est. speed input: 21117.40 toks/s, output: 7929.04 toks/s]Processed prompts:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 1485/2048 [00:05<00:01, 385.93it/s, est. speed input: 21403.65 toks/s, output: 8033.96 toks/s]Processed prompts:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 1538/2048 [00:06<00:01, 396.45it/s, est. speed input: 21714.24 toks/s, output: 8148.08 toks/s]Processed prompts:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 1590/2048 [00:06<00:01, 413.18it/s, est. speed input: 22040.97 toks/s, output: 8268.39 toks/s]Processed prompts:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 1647/2048 [00:06<00:00, 452.83it/s, est. speed input: 22472.33 toks/s, output: 8427.84 toks/s]Processed prompts:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 1713/2048 [00:06<00:00, 483.83it/s, est. speed input: 22944.63 toks/s, output: 8602.33 toks/s]Processed prompts:  88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 1800/2048 [00:06<00:00, 567.86it/s, est. speed input: 23701.30 toks/s, output: 8882.77 toks/s]Processed prompts:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 1941/2048 [00:06<00:00, 777.69it/s, est. speed input: 25153.08 toks/s, output: 9421.93 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:06<00:00, 777.69it/s, est. speed input: 26453.85 toks/s, output: 9905.71 toks/s]Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2048/2048 [00:06<00:00, 309.55it/s, est. speed input: 26453.85 toks/s, output: 9905.71 toks/s]
âœ“ Attention data parallelism performance test results:
  Number of prompts: 2048
  Baseline time: 7.13s
  Data parallel time: 8.36s
  Speedup: 0.85x
  Baseline throughput: 287.40 prompts/s
  Data parallel throughput: 244.96 prompts/s
PASSED

=============================== warnings summary ===============================
../miniconda3/envs/wenxin_test/lib/python3.12/site-packages/tpu_info/device.py:32
  /home/wenxindong_google_com/miniconda3/envs/wenxin_test/lib/python3.12/site-packages/tpu_info/device.py:32: DeprecationWarning: In 3.13 classes created inside an enum will not become a member.  Use the `member` decorator to keep the current behavior.
    class Info(typing.NamedTuple):

<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute

<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute

tests/e2e/test_data_parallel.py::test_dp_performance
  /home/wenxindong_google_com/miniconda3/envs/wenxin_test/lib/python3.12/site-packages/torchax/interop.py:11: DeprecationWarning: jax.experimental.shard_map is deprecated in v0.8.0. Used jax.shard_map instead.
    from jax.experimental.shard_map import shard_map

tests/e2e/test_data_parallel.py::test_dp_performance
tests/e2e/test_data_parallel.py::test_dp_performance
tests/e2e/test_data_parallel.py::test_dp_performance
tests/e2e/test_data_parallel.py::test_dp_performance
  /home/wenxindong_google_com/miniconda3/envs/wenxin_test/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=3942209) is multi-threaded, use of fork() may lead to deadlocks in the child.
    self.pid = os.fork()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================== 1 passed, 8 warnings in 416.33s (0:06:56) ===================
sys:1: DeprecationWarning: builtin type swigvarlink has no __module__ attribute
